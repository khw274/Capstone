# 캡스톤디자인
4-1/전자공학전공 캡스톤디자인 결과물


## 아이디어 
### 전기차충전기용 비전인식 시스템
#### - 아이디어 선정 배경 
㈜채비, 전기차 충전 통합 솔루션을 개발하는 회사와 협업할 수 있는 좋은 기회를 얻었고, 서로 지향하는 개발 방향이 일치해 아이디어를 정하였다.

아이디어의 핵심은 차량의 번호판을 인식하면 등록된 사용자 정보를 불러옴으로써 기존의 전기차 충전기의 충전 순서를 생략하여 더욱 편리하고 빠른 전기차 충전시스템을 구축하는 것이다.

팀원과의 역할은 충전기 구조물 제작 / 충전 인터페이스 디자인 및 번호판 제작 / SW 설계 및 임베디드로 구분하여 진행하였다.
  
내가 맡은 역할은 ```SW 설계 및 동작 확인, 임베디드``` 이다.


## 개발 과정
### 공통
#### - 아이디어 구체화
전체적인 아이디어의 방향은 정해진 상태이기 때문에 최종 구현 목표를 정하고자 함.

캡스톤디자인의 기간은 한 학기로 정해져있어 짧은 편이고 실제 제작 기간은 3개월 남짓이기에 구현 목표 설정이 중요했다.

원래 목표는 채비의 전기차 충전기와 연계하여 실제로 테스트를 하고 싶었지만, 예산 부족과 시간적인 제한이 상당했다. 

따라서 멘토분과의 논의 끝에 OpenCV를 활용해 번호판 텍스트를 인식하고 준비해놓은 차량 DB와 실제 충전 인터페이스를 구현한 영상을 불러오는 것을 최종목표로 하였다.

### SW / 임베디드
#### - 부품 및 개발 언어 선정
##### 1. 개발 언어 선정
   
  C언어와 PYTHON 둘 중 하나로 정하기로 했다.
  
  C언어는 실행속도가 더 빠르다는 장점이 있지만. 그동안 출전한 경진대회에서 PYTHON을 주로 사용했기에 더 사용하기 쉽고 익숙한 PYTHON을 개발 언어로 선정하였다.

##### 2. MCU 선정

   전기차 충전기용 비전인식 시스템을 개발하기에 앞서 프로그램을 설계하고 구동하기 위해 라즈베리파이4(Raspberry Pi 4 Model B)를 MCU로 선정했다.

   아두이노와 라즈베리파이 중에서 고민을 했었지만, 아두이노는 C언어를 기반으로 사용하고 라즈베리파이는 C언어 뿐만 아니라 JAVA, PYTHON 등 여러 언어를 사용하는 장점이 있다. 개발 언어로 선정한 PYTHON을 더 용이하게 사용하기 위해 라즈베리파이를 사용하기로 했다. 
   
   또한 이전에 라즈베리파이 활용 및 코딩 교육을 수료한 경험도 선택에 있어서 큰 영향을 주었다.   
   <img src="https://github.com/khw274/Capstone/assets/125671828/e031429a-bf32-4e90-a1ee-135e062d7bb7" width="250" height="250"/>

##### 3. 기타 부품 선정

  카메라: 차량의 번호판을 인식하기 위해 L사의 웹캠을 사용했다. 초기에 라즈베리파이 카메라를 사용하려 했지만 외관상의 문제와 각도 조절의 이점 등의 이유로 변경하게 되었다.

  스위치 센서: 프로그램을 구동시킬 수 있도록 라즈베리파이와 연결하기 용이한 구조의 버튼형 스위치 센서(VCC, GND, INPUT 구조)로 선정함.

  모니터: 라즈베리파이 전용 모니터를 구매하려고 했지만 구매할 수 없는 부품이라고 학교측에서 연락을 받았다.  그 대안으로 학교에서 S사 태블릿 PC를 대여받을 수 있었다.

  
#### - 프로그램 설계
코드를 짜기 전 다음과 같은 5개의 틀로 코드의 구성을 계획함. 
1. 스위치 센서
2. 카메라 작동 및 촬영/저장
3. 촬영된 파일을 불러온 뒤 번호 추출
4. 추출된 번호에 따라 적합한 영상 실행
5. 저장된 image를 삭제하고 초기화

최종. 라즈베리파이와 태블릿 연결

##### 1. 스위치 센서
  사용자가 전기차 충전기 앞에 주차를 한 후 스위치를 눌러 프로그램을 동작시키는 방법으로 구상을 했기에 스위치 센서는 필수적인 요소이다.

  직관성 있고 뚜렷한 형태, 그리고 라즈베리파이와의 연결을 위해 (VCC, GND, INPUT) 구조로 구성된 스위치 센서를 사용했다.  
  <img src="https://github.com/khw274/Capstone/assets/125671828/33540e10-fcd2-46a1-a645-bef2583eabcf" width="250" height="250"/>


  라즈베리파이에는 용도별로 GPIO핀이 구성되어 있다. 브레드보드를 이용해 라즈베리파이와 스위치 센서의 전원(VCC), 접지(GND), 입력(INPUT)을 서로 연결하였다.  
  <img src="https://github.com/khw274/Capstone/assets/125671828/ac4e6b82-3dce-44a3-b4d4-64138fd459ab" width="400" height="400"/>  <img src="https://github.com/khw274/Capstone/assets/125671828/8424dd25-ae0f-4f1d-bcc4-2f13f23cae89" width="400" height="400"/>
  
  사용했던 핀을 색깔별로 표시해두었다.(초록색: INPUT, 빨간색: 라즈베리파이 연결, 파란색: 스위치 센서 연결)
  
  스위치 센서의 입력값이 들어올 핀은 18번으로 설정했다. 

  이제 스위치 센서 입력값을 불러올 코드를 설계해야 한다.

```
import RPi.GPIO as GPIO  # 라즈베리파이 GPIO 제어 라이브러리

GPIO.setmode(GPIO.BCM)  # GPIO 핀 번호 체계를 BCM 모드로 설정
GPIO.setup(18, GPIO.IN, GPIO.PUD_UP)  # GPIO 18번 핀을 입력 모드로 설정하고 풀업 저항 활성화

while 1:  # 무한 루프 시작
    x = GPIO.input(18)  # GPIO 18번 핀의 입력 값을 읽어 변수 x에 저장
    # print(x)  # 디버깅용: 스위치가 눌리면 x = 0, 눌리지 않으면 x = 1

    if x == 0:  # 스위치가 눌렸을 때
        print('스위치 ON')  # '스위치 ON' 메시지 출력

        # 이후 코드들 실행
```
라즈베리파이 GPIO 제어 라이브러리를 불러오고 실제 핀과 동일하게 사용할 수 있도록 BCM 모드로 설정했다.

18번핀의 입력값을 우선 확인해야 하는데, 스위치를 켰을 시 LOW(0), 스위치를 껐을 시 HIGH(1)를 출력하는 것을 print를 통해 확인.

그 후 조건문을 통해 스위치를 눌렀을 시 이후 코드들을 모두 작동할 수 있도록 설계했다.

##### 2. 카메라 
다음은 자동차 번호판 인식을 위한 카메라를 라즈베리파이와 연결하고, 이미지를 촬영하고 지정한 이름으로 저장하는 코드를 설계해야 한다.
<img src="https://github.com/khw274/Capstone/assets/125671828/b361163e-b686-4c73-b774-4b7b413ba983" width="380" height="380"/>  
USB 형태로 라즈베리파이에 쉽게 연결할 수 있는 구조이며 위아래로 각도 조절이 가능해 위치를 조절하는데 용이한 장점이 있었다.





##### 3. 번호 추출
##### 4. 영상 실행
##### 5. 초기화




  
